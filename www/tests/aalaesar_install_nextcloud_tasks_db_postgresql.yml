- name: '[PostgreSQL] - PostgreSQL packages are installed'
  package:
    name: '{{ item }}'
    state: present
  with_items:
  - postgresql
  - php{{ php_ver }}-pgsql
  - python-psycopg2
- name: '[PostgreSQL] - generate nextcloud role password.'
  set_fact: nextcloud_db_pwd="{{ lookup( 'password', 'nextcloud_instances/'+ nextcloud_instance_name
    +'/pgsql_nc.pwd' ) }}"
  when: nextcloud_db_pwd is not defined
- become: true
  become_user: postgres
  name: '[PostgreSQL] - nextcloud role is created.'
  postgresql_user:
    encrypted: true
    name: '{{ nextcloud_db_admin }}'
    password: '{{ nextcloud_db_pwd }}'
    role_attr_flags: CREATEDB
    state: present
- become: true
  become_user: postgres
  name: '[PostgreSQL] - nextcloud database is created.'
  postgresql_db:
    name: '{{ nextcloud_db_name }}'
    owner: '{{ nextcloud_db_admin }}'
    state: present
